/*! jQuery Tone Curve - v0.3.0 - 2012-10-12
* Copyright (c) 2012 moi; Licensed MIT */
(function(e){var t,n,r;return n=function(){function f(t,r){var i,s;this.target=t,this.config=r,i=e(this.target),s=i.data("tonecurve"),s||i.data("tonecurve",this.target.src),s&&this.config.origin&&(this.target.src=s),i.imagesLoaded(e.proxy(n,this))}var n,r,i,s,o,u,a;return u=256,n=function(){var e,t,n,u;a.call(this);if(!i.call(this))return!1;n=this.config.input,e={r:!1,g:!1,b:!1,a:!1};for(t in n){u=n[t];if(t.length>1)continue;t.match(/r/i)&&(e.r=u),t.match(/g/i)&&(e.g=u),t.match(/b/i)&&(e.b=u),t.match(/a/i)&&(e.a=u)}for(t in n){u=n[t];if(t.length<2)continue;!e.r&&t.match(/r/i)&&(e.r=u),!e.g&&t.match(/g/i)&&(e.g=u),!e.b&&t.match(/b/i)&&(e.b=u),!e.a&&t.match(/a/i)&&(e.a=u)}return this.curve={},e.r&&(this.curve.r=s.call(this,e.r)),e.g&&(this.curve.g=s.call(this,e.g)),e.b&&(this.curve.b=s.call(this,e.b)),e.a&&(this.curve.a=s.call(this,e.a)),o.call(this),r.call(this)},a=function(){return this.width=this.target.naturalWidth||this.target.width,this.height=this.target.naturalHeight||this.target.height},i=function(){var e;return e=document.createElement("canvas"),e.getContext?(e.width=this.width,e.height=this.height,this.canvas=e,this.context=e.getContext("2d"),this.context.drawImage(this.target,0,0),!0):!1},s=function(e){var n,r,i,s,o,a,f,l,c,h;i=[],a=[],f=[];for(s=l=0,h=e.length;0<=h?l<h:l>h;s=0<=h?++l:--l)o=e[s],a.push(o[0]),f.push(o[1]);n=new t(a,f);for(r=c=0;0<=u?c<u:c>u;r=0<=u?++c:--c)i[r]=n.interpolate(r);return i},o=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;s=this.config.channel,c=this.width,a=this.height,o=this.context,r=this.Lx,l=o.getImageData(0,0,c,a),u=this.curve;for(p=d=0;0<=a?d<a:d>a;p=0<=a?++d:--d)for(h=v=0;0<=c?v<c:v>c;h=0<=c?++v:--v)f=(p*c+h)*4,u.r&&(i=l.data[f],l.data[f]=Math.round(u.r[i])),u.g&&(n=l.data[f+1],l.data[f+1]=Math.round(u.g[n])),u.b&&(t=l.data[f+2],l.data[f+2]=Math.round(u.b[t])),u.a&&(e=l.data[f+3],l.data[f+3]=Math.round(u.a[e]));return o.putImageData(l,0,0),this.dataURL=this.canvas.toDataURL()},r=function(){return this.target.src=this.dataURL},f}(),t=function(){function e(e,t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;a=e.length,i=[],u=[],n=[],r=[],s=[],f=[];for(o=c=0,b=a-1;0<=b?c<b:c>b;o=0<=b?++c:--c)i[o]=(t[o+1]-t[o])/(e[o+1]-e[o]),o>0&&(u[o]=(i[o-1]+i[o])/2);u[0]=i[0],u[a-1]=i[a-2],l=[];for(o=h=0,w=a-1;0<=w?h<w:h>w;o=0<=w?++h:--h)i[o]===0&&l.push(o);for(p=0,v=l.length;p<v;p++)o=l[p],u[o]=u[o+1]=0;for(o=d=0,E=a-1;0<=E?d<E:d>E;o=0<=E?++d:--d)n[o]=u[o]/i[o],r[o]=u[o+1]/i[o],s[o]=Math.pow(n[o],2)+Math.pow(r[o],2),f[o]=3/Math.sqrt(s[o]);l=[];for(o=g=0,S=a-1;0<=S?g<S:g>S;o=0<=S?++g:--g)s[o]>9&&l.push(o);for(y=0,m=l.length;y<m;y++)o=l[y],u[o]=f[o]*n[o]*i[o],u[o+1]=f[o]*r[o]*i[o];this.x=e.slice(0,a),this.y=t.slice(0,a),this.m=u}return e.prototype.interpolate=function(e){var t,n,r,i,s,o,u,a,f,l,c,h;for(o=c=h=this.x.length-2;h<=0?c<=0:c>=0;o=h<=0?++c:--c)if(this.x[o]<=e)break;return t=this.x[o+1]-this.x[o],u=(e-this.x[o])/t,a=Math.pow(u,2),f=Math.pow(u,3),n=2*f-3*a+1,i=f-2*a+u,r=-2*f+3*a,s=f-a,l=n*this.y[o]+i*t*this.m[o]+r*this.y[o+1]+s*t*this.m[o+1],l},e}(),r=function(t){var n;return n={rgb:[],r:[],g:[],b:[]},e.ajax({url:t,async:!1,dataType:"dataview"}).success(function(e){var t,r,i,s,o,u,a,f,l,c;r=["r","g","b"],e.seek(4),o=e.getUint16()&255,t=n.rgb,t.push([0,e.getUint16()&255]),e.seek(e.tell()+2);for(i=f=1;1<=o?f<o:f>o;i=1<=o?++f:--f)a=e.getUint16()&255,u=e.getUint16()&255,t.push([u,a]);c=[];for(i=l=0;l<3;i=++l)o=e.getUint16()&255,t=n[r[i]],c.push(function(){var n,r;r=[];for(s=n=0;0<=o?n<o:n>o;s=0<=o?++n:--n)a=e.getUint16()&255,u=e.getUint16()&255,r.push(t.push([u,a]));return r}());return c}),n},e.fn.tonecurve=function(t,i){var s,o;o={input:t,origin:i},s=e.extend(!0,{},o);if(typeof t=="string"){if(!jDataView)return this;s.input=r(t)}return this.each(function(){return new n(this,s)})}})(jQuery),function(e,t){var n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";e.fn.imagesLoaded=function(r){function i(){var t=e(h),n=e(p);u&&(p.length?u.reject(f,t,n):u.resolve(f)),e.isFunction(r)&&r.call(o,f,t,n)}function s(t,r){t.src===n||-1!==e.inArray(t,l)||(l.push(t),r?p.push(t):h.push(t),e.data(t,"imagesLoaded",{isBroken:r,src:t.src}),a&&u.notifyWith(e(t),[r,f,e(h),e(p)]),f.length===l.length&&(setTimeout(i),f.unbind(".imagesLoaded")))}var o=this,u=e.isFunction(e.Deferred)?e.Deferred():0,a=e.isFunction(u.notify),f=o.find("img").add(o.filter("img")),l=[],h=[],p=[];return f.length?f.bind("load.imagesLoaded error.imagesLoaded",function(e){s(e.target,"error"===e.type)}).each(function(r,i){var o=i.src,u=e.data(i,"imagesLoaded");if(u&&u.src===o)s(i,u.isBroken);else if(i.complete&&i.naturalWidth!==t)s(i,0===i.naturalWidth||0===i.naturalHeight);else if(i.readyState||i.complete)i.src=n,i.src=o}):i(),u?u.promise(o):o}}(jQuery);