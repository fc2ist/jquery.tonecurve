/*! jQuery Tone Curve - v0.1.0 - 2012-10-11
* Copyright (c) 2012 moi; Licensed MIT */
(function(e){var t,n;return t=function(){function a(n,r){var i,s;this.target=n,this.config=r,i=e(this.target),this.config.origin&&(s=i.data("tonecurve"),s&&(this.target.src=s)),i.imagesLoaded(e.proxy(t,this))}var t,n,r,i,s,o,u;return o=256,t=function(){return u.call(this),r.call(this)?(i.call(this),s.call(this),n.call(this)):!1},u=function(){return this.width=this.target.width,this.height=this.target.height},r=function(){var e;return e=document.createElement("canvas"),e.getContext?(e.width=this.width,e.height=this.height,this.canvas=e,this.context=e.getContext("2d"),this.context.drawImage(this.target,0,0),!0):!1},i=function(){var e,t,n,r,i,s,u,a,f,l,c,h,p;u=this.config.input,s=u.length,e=new Array(o);for(n=a=0;0<=o?a<o:a>o;n=0<=o?++a:--a){e[n]=new Array(s);for(r=f=0;0<=s?f<s:f>s;r=0<=s?++f:--f)e[n][r]=1;for(r=l=0;0<=s?l<s:l>s;r=0<=s?++l:--l)for(i=c=0;0<=s?c<s:c>s;i=0<=s?++c:--c){if(r===i)continue;e[n][i]*=(n-u[r][0])/(u[i][0]-u[r][0])}}t=new Array(o);for(n=h=0;0<=o?h<o:h>o;n=0<=o?++h:--h){t[n]=0;for(r=p=0;0<=s?p<s:p>s;r=0<=s?++p:--p)t[n]+=e[n][r]*u[r][1]}return this.Lx=t},s=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;s=this.config.channel,c=this.width,a=this.height,u=this.context,r=this.Lx,l=u.getImageData(0,0,c,a),o={r:!1,g:!1,b:!1,a:!1},s.match(/r/i)&&(o.r=!0),s.match(/g/i)&&(o.g=!0),s.match(/b/i)&&(o.b=!0),s.match(/a/i)&&(o.a=!0);for(p=d=0;0<=a?d<a:d>a;p=0<=a?++d:--d)for(h=v=0;0<=c?v<c:v>c;h=0<=c?++v:--v)f=(p*c+h)*4,o.r&&(i=l.data[f],l.data[f]=Math.round(r[i])),o.g&&(n=l.data[f+1],l.data[f+1]=Math.round(r[n])),o.b&&(t=l.data[f+2],l.data[f+2]=Math.round(r[t])),o.a&&(e=l.data[f+3],l.data[f+3]=Math.round(r[e]));return u.putImageData(l,0,0),this.dataURL=this.canvas.toDataURL()},n=function(){return this.target.src=this.dataURL},a}(),e.fn.tonecurve=function(r,i){var s,o;return o={channel:r,input:i},s=e.extend(!0,{},n,o),this.each(function(){return new t(this,s)})},n={channel:"rgb",input:[[128,64]],origin:!1}})(jQuery),function(e,t){var n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";e.fn.imagesLoaded=function(r){function i(){var t=e(h),n=e(p);u&&(p.length?u.reject(f,t,n):u.resolve(f)),e.isFunction(r)&&r.call(o,f,t,n)}function s(t,r){t.src===n||-1!==e.inArray(t,l)||(l.push(t),r?p.push(t):h.push(t),e.data(t,"imagesLoaded",{isBroken:r,src:t.src}),a&&u.notifyWith(e(t),[r,f,e(h),e(p)]),f.length===l.length&&(setTimeout(i),f.unbind(".imagesLoaded")))}var o=this,u=e.isFunction(e.Deferred)?e.Deferred():0,a=e.isFunction(u.notify),f=o.find("img").add(o.filter("img")),l=[],h=[],p=[];return f.length?f.bind("load.imagesLoaded error.imagesLoaded",function(e){s(e.target,"error"===e.type)}).each(function(r,i){var o=i.src,u=e.data(i,"imagesLoaded");if(u&&u.src===o)s(i,u.isBroken);else if(i.complete&&i.naturalWidth!==t)s(i,0===i.naturalWidth||0===i.naturalHeight);else if(i.readyState||i.complete)i.src=n,i.src=o}):i(),u?u.promise(o):o}}(jQuery);