/*! jQuery Tone Curve - v0.2.1 - 2012-10-11
* Copyright (c) 2012 moi; Licensed MIT */
(function(e){var t,n;return t=function(){function a(n,r){var i,s;this.target=n,this.config=r,i=e(this.target),this.config.origin&&(s=i.data("tonecurve"),s&&(this.target.src=s)),i.imagesLoaded(e.proxy(t,this))}var t,n,r,i,s,o,u;return o=256,t=function(){var e,t,o,a;u.call(this);if(!r.call(this))return!1;o=this.config.input,e={r:!1,g:!1,b:!1,a:!1};for(t in o)a=o[t],!e.r&&t.match(/r/i)&&(e.r=a),!e.g&&t.match(/g/i)&&(e.g=a),!e.b&&t.match(/b/i)&&(e.b=a),!e.a&&t.match(/a/i)&&(e.a=a);return this.curve={},e.r&&(this.curve.r=i.call(this,e.r)),e.g&&(this.curve.g=i.call(this,e.g)),e.b&&(this.curve.b=i.call(this,e.b)),e.a&&(this.curve.a=i.call(this,e.a)),s.call(this),n.call(this)},u=function(){return this.width=this.target.naturalWidth||this.target.width,this.height=this.target.naturalHeight||this.target.height},r=function(){var e;return e=document.createElement("canvas"),e.getContext?(e.width=this.width,e.height=this.height,this.canvas=e,this.context=e.getContext("2d"),this.context.drawImage(this.target,0,0),!0):!1},i=function(e){var t,n,r,i,s,u,a,f,l,c,h,p;u=e.length,t=new Array(o);for(r=a=0;0<=o?a<o:a>o;r=0<=o?++a:--a){t[r]=new Array(u);for(i=f=0;0<=u?f<u:f>u;i=0<=u?++f:--f)t[r][i]=1;for(i=l=0;0<=u?l<u:l>u;i=0<=u?++l:--l)for(s=c=0;0<=u?c<u:c>u;s=0<=u?++c:--c){if(i===s)continue;t[r][s]*=(r-e[i][0])/(e[s][0]-e[i][0])}}n=new Array(o);for(r=h=0;0<=o?h<o:h>o;r=0<=o?++h:--h){n[r]=0;for(i=p=0;0<=u?p<u:p>u;i=0<=u?++p:--p)n[r]+=t[r][i]*e[i][1]}return n},s=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;s=this.config.channel,c=this.width,a=this.height,o=this.context,r=this.Lx,l=o.getImageData(0,0,c,a),u=this.curve;for(p=d=0;0<=a?d<a:d>a;p=0<=a?++d:--d)for(h=v=0;0<=c?v<c:v>c;h=0<=c?++v:--v)f=(p*c+h)*4,u.r&&(i=l.data[f],l.data[f]=Math.round(u.r[i])),u.g&&(n=l.data[f+1],l.data[f+1]=Math.round(u.g[n])),u.b&&(t=l.data[f+2],l.data[f+2]=Math.round(u.b[t])),u.a&&(e=l.data[f+3],l.data[f+3]=Math.round(u.a[e]));return o.putImageData(l,0,0),this.dataURL=this.canvas.toDataURL()},n=function(){return this.target.src=this.dataURL},a}(),e.fn.tonecurve=function(r,i){var s,o;return o={input:r,origin:i},r||(o.input={rgb:[[0,0],[128,64],[255,255]]}),s=e.extend(!0,{},n,o),this.each(function(){return new t(this,s)})},n={origin:!1}})(jQuery),function(e,t){var n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";e.fn.imagesLoaded=function(r){function i(){var t=e(h),n=e(p);u&&(p.length?u.reject(f,t,n):u.resolve(f)),e.isFunction(r)&&r.call(o,f,t,n)}function s(t,r){t.src===n||-1!==e.inArray(t,l)||(l.push(t),r?p.push(t):h.push(t),e.data(t,"imagesLoaded",{isBroken:r,src:t.src}),a&&u.notifyWith(e(t),[r,f,e(h),e(p)]),f.length===l.length&&(setTimeout(i),f.unbind(".imagesLoaded")))}var o=this,u=e.isFunction(e.Deferred)?e.Deferred():0,a=e.isFunction(u.notify),f=o.find("img").add(o.filter("img")),l=[],h=[],p=[];return f.length?f.bind("load.imagesLoaded error.imagesLoaded",function(e){s(e.target,"error"===e.type)}).each(function(r,i){var o=i.src,u=e.data(i,"imagesLoaded");if(u&&u.src===o)s(i,u.isBroken);else if(i.complete&&i.naturalWidth!==t)s(i,0===i.naturalWidth||0===i.naturalHeight);else if(i.readyState||i.complete)i.src=n,i.src=o}):i(),u?u.promise(o):o}}(jQuery);